-- ~/.config/nvim/lsp/terraform_ls.lua
-- Modern Neovim 0.11+ compatible LSP config for Terraform

local util = require("lspconfig.util")

return {
	cmd = { "terraform-ls", "serve" },

	filetypes = {
		"terraform",
		"terraform-vars",
		"terraform-stack",
		"terraform-search",
		"terraform-deploy",
		-- "tf",
		-- "hcl",
		-- "tfvars",
	},

	root_markers = { "main.tf", ".git", "terraform.tfvars", ".terraform" },

	-- Optional: Terraform LSP has a schema/hcl-specific setting block
	settings = {
		terraform = {
			-- enable formatting (if desired)
			format = {
				enable = true,
			},
			languageServer = {
				rootModules = { ".", "modules/*", "env/*", "infra/*" },
				excludeRootModules = { "vendor/*", "test/fixtures/*" },
				experimentalFeatures = {
					validateOnSave = true,
				},
			},
		},
	},
}
